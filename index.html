<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Caf√© Portal ‚Äî Men√∫ Interactivo</title>
  <style>
    :root{
      --bg:#050712;
      --card:#0b1024;
      --muted:#8aa0ff;
      --text:#eaf0ff;
      --line:#1a2550;
      --accent:#39b8ff;
      --accent2:#7c4dff;
      --good:#2cf6c4;
      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --radius:18px;
    }
    *{box-sizing:border-box}

    /* ===== Fondo estrellas (canvas) ===== */
    #starfield{
      position:fixed;
      inset:0;
      z-index:-2;
      width:100%;
      height:100%;
      pointer-events:none;
      opacity:.85;
    }

    /* Glow suave extra (detr√°s del contenido) */
    .bg-glow{
      position:fixed;
      inset:-20%;
      z-index:-3;
      background:
        radial-gradient(1200px 800px at 20% 10%, rgba(57,184,255,.18), transparent 55%),
        radial-gradient(900px 600px at 80% 20%, rgba(124,77,255,.18), transparent 60%),
        radial-gradient(800px 700px at 55% 90%, rgba(44,246,196,.10), transparent 60%),
        var(--bg);
      filter:saturate(1.15);
    }

    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
      color:var(--text);
      min-height:100vh;
      padding-bottom: 84px; /* espacio para bot√≥n flotante */
      background: transparent;
    }

    header{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(12px);
      background: linear-gradient(to bottom, rgba(5,7,18,.94), rgba(5,7,18,.55));
      border-bottom:1px solid rgba(26,37,80,.6);
    }

    .wrap{max-width:1150px; margin:0 auto; padding:18px 16px}
    .top{display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap;}

    .brand{display:flex; align-items:center; gap:12px; user-select:none;}
    .logo{
      width:44px; height:44px; border-radius:14px;
      background:
        radial-gradient(circle at 30% 30%, rgba(57,184,255,.9), rgba(124,77,255,.7) 45%, rgba(44,246,196,.35) 75%, rgba(0,0,0,.0) 76%),
        linear-gradient(135deg, rgba(57,184,255,.35), rgba(124,77,255,.15));
      border:1px solid rgba(57,184,255,.35);
      box-shadow: 0 0 0 1px rgba(124,77,255,.25) inset, 0 0 26px rgba(57,184,255,.25);
      position:relative; overflow:hidden;
    }
    .logo:after{
      content:"";
      position:absolute; inset:-40%;
      background: conic-gradient(from 0deg, rgba(57,184,255,.0), rgba(57,184,255,.35), rgba(124,77,255,.35), rgba(44,246,196,.25), rgba(57,184,255,.0));
      animation: spin 7s linear infinite;
      filter: blur(1px);
      opacity:.85;
    }
    @keyframes spin{to{transform:rotate(360deg)}}

    /* ===== Header tipo p√≥ster ===== */
    .portalTitle{
      margin:0;
      font-weight:1000;
      letter-spacing:2.6px;
      text-transform:uppercase;
      font-size:18px;
      text-shadow: 0 0 14px rgba(57,184,255,.40), 0 0 32px rgba(57,184,255,.18);
      line-height:1.05;
    }
    .sub{
      font-size:12px;
      color:rgba(234,240,255,.72);
      margin-top:4px;
      letter-spacing:1px;
      text-transform:uppercase;
    }

    /* Separador brillante (estilo p√≥ster) */
    .glow-divider{
      height:1px;
      width:100%;
      margin-top:12px;
      background: linear-gradient(90deg,
        rgba(57,184,255,0),
        rgba(57,184,255,.55),
        rgba(124,77,255,.45),
        rgba(57,184,255,.55),
        rgba(57,184,255,0)
      );
      box-shadow: 0 0 18px rgba(57,184,255,.18);
      opacity:.9;
    }

    .controls{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:flex-end;
      flex:1;
    }
    .search{
      flex:1; min-width:230px;
      display:flex; align-items:center; gap:10px;
      padding:10px 12px;
      background: rgba(11,16,36,.75);
      border:1px solid rgba(26,37,80,.7);
      border-radius:14px;
      box-shadow: 0 0 0 1px rgba(57,184,255,.08) inset;
    }
    .search input{
      width:100%;
      background:transparent; border:0; outline:0;
      color:var(--text); font-size:14px;
    }

    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(26,37,80,.8);
      background: rgba(11,16,36,.65);
      color:rgba(234,240,255,.92);
      font-size:13px;
      cursor:pointer;
      user-select:none;
      transition:transform .08s ease, border-color .15s ease, background .15s ease;
      text-transform:uppercase;
      letter-spacing:1.4px;
      font-weight:900;
    }
    .pill:hover{transform:translateY(-1px); border-color: rgba(57,184,255,.55)}
    .pill.active{
      border-color: rgba(57,184,255,.75);
      background: linear-gradient(135deg, rgba(57,184,255,.18), rgba(124,77,255,.14));
      box-shadow: 0 0 0 1px rgba(57,184,255,.18) inset, 0 0 24px rgba(57,184,255,.12);
    }

    .grid{
      display:grid;
      grid-template-columns: 290px 1fr 330px;
      gap:16px;
      margin-top:16px;
      align-items:start;
    }
    @media (max-width: 1050px){ .grid{grid-template-columns: 1fr; } }

    .panel{
      background: rgba(11,16,36,.62);
      border:1px solid rgba(26,37,80,.7);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    /* l√≠nea brillante dentro del panel */
    .panel:before{
      content:"";
      position:absolute;
      left:12px; right:12px; top:44px;
      height:1px;
      background: linear-gradient(90deg,
        rgba(57,184,255,0),
        rgba(57,184,255,.45),
        rgba(124,77,255,.35),
        rgba(57,184,255,.45),
        rgba(57,184,255,0)
      );
      opacity:.7;
    }

    .panel h2{
      font-size:13px;
      text-transform:uppercase;
      letter-spacing:1.6px;
      color:rgba(234,240,255,.82);
      margin:0;
      padding:14px 14px 12px;
      border-bottom:1px solid rgba(26,37,80,.65);
      background: linear-gradient(to bottom, rgba(11,16,36,.88), rgba(11,16,36,.35));
      text-shadow: 0 0 14px rgba(57,184,255,.22);
      font-weight:900;
    }

    .cats{padding:10px}
    .catbtn{
      width:100%;
      text-align:left;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid transparent;
      background: transparent;
      color:rgba(234,240,255,.92);
      cursor:pointer;
      display:flex; justify-content:space-between; align-items:center;
      text-transform:uppercase;
      letter-spacing:1.2px;
      font-weight:900;
    }
    .catbtn:hover{background: rgba(57,184,255,.08)}
    .catbtn.active{
      background: linear-gradient(135deg, rgba(57,184,255,.14), rgba(124,77,255,.10));
      border-color: rgba(57,184,255,.35);
      box-shadow: 0 0 22px rgba(57,184,255,.10);
    }
    .badge{
      font-size:12px; color:rgba(234,240,255,.75);
      border:1px solid rgba(26,37,80,.7);
      padding:3px 8px; border-radius:999px;
      background: rgba(5,7,18,.35);
      text-transform:none;
      letter-spacing:.2px;
      font-weight:800;
    }

    .content{padding:14px}
    .sectiontitle{
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      margin-bottom:10px;
      flex-wrap:wrap;
    }
    .sectiontitle h3{
      margin:0;
      font-size:16px;
      text-transform:uppercase;
      letter-spacing:1.6px;
      text-shadow: 0 0 14px rgba(57,184,255,.22);
      font-weight:1000;
    }
    .hint{font-size:12px; color:rgba(234,240,255,.65)}
    .subtabs{display:flex; gap:8px; flex-wrap:wrap;}

    .cards{
      display:grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap:12px;
    }
    @media (max-width: 1040px){ .cards{grid-template-columns: repeat(2, minmax(0,1fr));} }
    @media (max-width: 560px){ .cards{grid-template-columns:1fr;} }

    .item{
      background: rgba(5,7,18,.35);
      border:1px solid rgba(26,37,80,.75);
      border-radius: 18px;
      padding:12px;
      position:relative;
      overflow:hidden;
      transition: transform .10s ease, border-color .15s ease, background .15s ease;
    }
    .item:after{
      content:"";
      position:absolute;
      inset:-2px;
      background: radial-gradient(400px 120px at 20% 10%, rgba(57,184,255,.10), transparent 55%);
      pointer-events:none;
      opacity:.9;
    }
    .item:hover{
      transform: translateY(-2px);
      border-color: rgba(57,184,255,.55);
      background: rgba(5,7,18,.55);
    }

    .tagrow{display:flex; gap:8px; flex-wrap:wrap; margin-bottom:8px}
    .tag{
      font-size:11px;
      padding:3px 8px;
      border-radius:999px;
      border:1px solid rgba(26,37,80,.7);
      background: rgba(11,16,36,.55);
      color: rgba(234,240,255,.78);
      text-transform:uppercase;
      letter-spacing:1px;
      font-weight:800;
    }
    .tag.hot{border-color: rgba(255,204,102,.5); color: rgba(255,204,102,.95)}
    .tag.cold{border-color: rgba(57,184,255,.55); color: rgba(57,184,255,.95)}
    .tag.frappe{border-color: rgba(124,77,255,.55); color: rgba(124,77,255,.95)}
    .tag.special{border-color: rgba(44,246,196,.45); color: rgba(44,246,196,.95)}

    .name{
      font-weight:1000;
      margin:0 0 6px;
      font-size:15px;
      text-transform:uppercase;
      letter-spacing:1.4px;
    }
    .desc{margin:0 0 10px; font-size:12px; color:rgba(234,240,255,.68); line-height:1.35}

    .prices{display:flex; gap:8px; flex-wrap:wrap; align-items:center}
    .pricebtn{
      padding:8px 10px;
      border-radius:12px;
      border:1px solid rgba(26,37,80,.8);
      background: rgba(11,16,36,.7);
      color: rgba(234,240,255,.92);
      cursor:pointer;
      font-size:13px;
      display:inline-flex; align-items:center; gap:8px;
      box-shadow: 0 0 22px rgba(57,184,255,.08);
      text-transform:uppercase;
      letter-spacing:1.2px;
      font-weight:900;
    }
    .pricebtn:hover{border-color: rgba(57,184,255,.55)}
    .pricebtn small{opacity:.7; font-weight:900}

    .cart{position:sticky; top:92px}
    .cartbox{padding:12px}
    .cartlist{display:flex; flex-direction:column; gap:8px; margin:10px 0 12px}
    .lineitem{
      display:flex; gap:10px; justify-content:space-between; align-items:flex-start;
      padding:10px;
      border-radius:14px;
      border:1px solid rgba(26,37,80,.7);
      background: rgba(5,7,18,.35);
    }
    .li-title{font-size:13px; font-weight:1000; margin:0; text-transform:uppercase; letter-spacing:1.1px}
    .li-sub{font-size:12px; color:rgba(234,240,255,.65); margin-top:2px}
    .li-actions{display:flex; gap:8px; align-items:center}
    .mini{
      width:30px; height:30px; border-radius:10px;
      border:1px solid rgba(26,37,80,.8);
      background: rgba(11,16,36,.7);
      color: rgba(234,240,255,.92);
      cursor:pointer;
      display:grid; place-items:center;
      font-weight:1000;
    }
    .mini:hover{border-color: rgba(57,184,255,.55)}
    .qty{min-width:18px; text-align:center; font-weight:1000}

    .totals{
      display:flex; justify-content:space-between; align-items:center;
      padding-top:10px;
      border-top:1px solid rgba(26,37,80,.65);
      color: rgba(234,240,255,.9);
      text-transform:uppercase;
      letter-spacing:1.2px;
      font-weight:900;
    }
    .checkout{
      margin-top:10px;
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(57,184,255,.6);
      background: linear-gradient(135deg, rgba(57,184,255,.22), rgba(124,77,255,.18));
      color: rgba(234,240,255,.95);
      font-weight:1000;
      cursor:pointer;
      text-transform:uppercase;
      letter-spacing:1.6px;
    }
    .checkout:hover{box-shadow: 0 0 0 1px rgba(57,184,255,.2) inset, 0 0 30px rgba(57,184,255,.12)}

    dialog{
      border:1px solid rgba(26,37,80,.75);
      border-radius: 18px;
      background: rgba(11,16,36,.92);
      color: var(--text);
      box-shadow: var(--shadow);
      width:min(560px, 92vw);
      padding:0;
    }
    dialog::backdrop{background: rgba(0,0,0,.55)}
    .modalHead{
      padding:14px 14px 10px;
      border-bottom:1px solid rgba(26,37,80,.65);
      display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
    }
    .modalTitle{margin:0; font-size:16px; font-weight:1000; text-transform:uppercase; letter-spacing:1.6px}
    .close{
      width:34px; height:34px; border-radius:12px;
      border:1px solid rgba(26,37,80,.8);
      background: rgba(5,7,18,.35);
      color: rgba(234,240,255,.9);
      cursor:pointer;
      display:grid; place-items:center;
      font-weight:1000;
    }
    .close:hover{border-color: rgba(57,184,255,.55)}
    .modalBody{padding:14px}
    .row{display:flex; gap:10px; flex-wrap:wrap}
    select, textarea{
      width:100%;
      margin-top:6px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(26,37,80,.75);
      background: rgba(5,7,18,.45);
      color: rgba(234,240,255,.92);
      outline:none;
      text-transform:uppercase;
      letter-spacing:1px;
      font-weight:900;
    }
    textarea{
      min-height:92px;
      resize:vertical;
      text-transform:none;
      letter-spacing:.2px;
      font-weight:600;
    }
    label{font-size:12px; color:rgba(234,240,255,.75); text-transform:uppercase; letter-spacing:1.2px; font-weight:900}
    .modalActions{
      padding:14px;
      border-top:1px solid rgba(26,37,80,.65);
      display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap;
    }
    .btn{
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(26,37,80,.8);
      background: rgba(5,7,18,.35);
      color: rgba(234,240,255,.92);
      cursor:pointer;
      font-weight:1000;
      text-transform:uppercase;
      letter-spacing:1.4px;
    }
    .btn.primary{
      border-color: rgba(57,184,255,.6);
      background: linear-gradient(135deg, rgba(57,184,255,.22), rgba(124,77,255,.18));
    }
    .btn:hover{border-color: rgba(57,184,255,.55)}

    .footer{opacity:.65; font-size:12px; padding:22px 16px; text-align:center; text-transform:uppercase; letter-spacing:1.2px;}

    /* ===== Bot√≥n flotante WhatsApp ===== */
    #waFloat{
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: calc(14px + env(safe-area-inset-bottom, 0px));
      z-index: 9999;

      width: min(560px, calc(100vw - 28px));
      padding: 14px 14px;
      border-radius: 18px;

      border: 1px solid rgba(57,184,255,.65);
      background: linear-gradient(135deg, rgba(57,184,255,.26), rgba(124,77,255,.18));
      color: rgba(234,240,255,.98);

      font-weight: 1000;
      cursor: pointer;

      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;

      box-shadow: 0 18px 60px rgba(0,0,0,.50);
      text-transform:uppercase;
      letter-spacing:1.8px;
    }
    #waFloat .left{display:flex; align-items:center; gap:10px;}
    #waFloat .wabadge{
      background: rgba(5,7,18,.55);
      border: 1px solid rgba(26,37,80,.8);
      color: rgba(234,240,255,.9);
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 12px;
      text-transform:none;
      letter-spacing:.2px;
      opacity:.95;
      font-weight:900;
    }
    #waFloat:active{ transform: translateX(-50%) scale(.99); }
  </style>
</head>

<body>
  <div class="bg-glow" aria-hidden="true"></div>
  <canvas id="starfield" aria-hidden="true"></canvas>

  <header>
    <div class="wrap">
      <div class="top">
        <div class="brand">
          <div class="logo" aria-hidden="true"></div>
          <div>
            <p class="portalTitle" id="portalTitle">PORTAL ‚Äî MEN√ö</p>
            <div class="sub">Toca para agregar ‚Ä¢ pedido directo a WhatsApp</div>
          </div>
        </div>

        <div class="controls">
          <div class="search" role="search">
            <span style="opacity:.8">üîé</span>
            <input id="q" placeholder="Buscar: latte, limonada, dorilocos..." autocomplete="off"/>
          </div>
          <button class="pill active" id="baseAll" data-base="all">Todo</button>
          <button class="pill" id="baseCafe" data-base="Cafeter√≠a">Cafeter√≠a</button>
          <button class="pill" id="baseRef" data-base="Refresquer√≠a">Refresquer√≠a</button>
          <button class="pill" id="baseSnk" data-base="Snacks">Snacks</button>
        </div>
      </div>
      <div class="glow-divider"></div>
    </div>
  </header>

  <main class="wrap">
    <div class="grid">
      <aside class="panel">
        <h2>Categor√≠as</h2>
        <div class="cats" id="cats"></div>
      </aside>

      <section class="panel">
        <h2>Men√∫</h2>
        <div class="content">
          <div class="sectiontitle">
            <div style="display:flex; gap:10px; align-items:baseline; flex-wrap:wrap;">
              <h3 id="sectionName">Todo</h3>
              <div class="hint" id="resultHint"></div>
            </div>
            <div class="subtabs" id="subtabs"></div>
          </div>

          <div class="cards" id="cards"></div>

          <div class="hint" style="margin-top:12px; line-height:1.4">
            <strong>Sabores (caf√©s):</strong> Vainilla ‚Ä¢ Crema irlandesa ‚Ä¢ Avellana ‚Ä¢ Caramelo ‚Ä¢ Mocca
            <br/>
            <strong>Extras (caf√©s y refresquer√≠a especial):</strong> $10 (cuando aplique)
            <br/>
            <strong>Extras generales:</strong> Chamoy ‚Ä¢ Miguelito ‚Ä¢ Salsa ($5‚Äì$10)
          </div>
        </div>
      </section>

      <aside class="panel cart">
        <h2>Carrito</h2>
        <div class="cartbox">
          <div class="hint">Anota ‚Äúsin az√∫car‚Äù, ‚Äúextra chamoy‚Äù, etc.</div>
          <div class="cartlist" id="cartlist"></div>
          <div class="totals">
            <div><strong>Total</strong></div>
            <div><strong id="total">$0</strong></div>
          </div>
          <button class="checkout" id="checkout">Enviar pedido por WhatsApp</button>
          <div class="hint" style="margin-top:10px; line-height:1.35">
            Direcci√≥n: Gral. Pi√±a 197B, Col. Balderrama
          </div>
        </div>
      </aside>
    </div>

    <div class="footer">¬© Caf√© Portal ‚Äî Cruza el portal</div>
  </main>

  <!-- Modal -->
  <dialog id="modal">
    <div class="modalHead">
      <div>
        <p class="modalTitle" id="mTitle">Producto</p>
        <div class="hint" id="mMeta"></div>
      </div>
      <button class="close" id="mClose" aria-label="Cerrar">‚úï</button>
    </div>
    <div class="modalBody">
      <div class="row">
        <div style="flex:1; min-width:180px">
          <label>Tama√±o</label>
          <select id="mSize"></select>
        </div>
        <div style="flex:1; min-width:180px">
          <label>Opci√≥n</label>
          <select id="mOption"></select>
        </div>
      </div>

      <div style="margin-top:10px">
        <label>Extras (opcional)</label>
        <select id="mExtras"></select>
        <div class="hint" style="margin-top:6px">Cuando aplique: extras $10.</div>
      </div>

      <div style="margin-top:10px">
        <label>Notas (opcional)</label>
        <textarea id="mNotes" placeholder="Ej: sin az√∫car, leche deslactosada, extra chamoy..."></textarea>
      </div>
    </div>
    <div class="modalActions">
      <button class="btn" id="mCancel">Cancelar</button>
      <button class="btn primary" id="mAdd">Agregar</button>
    </div>
  </dialog>

  <!-- Bot√≥n flotante WhatsApp -->
  <button id="waFloat" title="Enviar pedido por WhatsApp">
    <span class="left">
      <span style="font-size:18px">üí¨</span>
      <span>Enviar pedido</span>
    </span>
    <span class="wabadge" id="waBadge">0 items ‚Ä¢ $0</span>
  </button>

  <script>
    // ====== CONFIG WHATSAPP ======
    const WHATSAPP_NUMBER = "526621448175";

    // ====== MEN√ö ======
    const MENU = [
      // Cafeter√≠a - Calientes
      { id:"c_hot_ame", baseCat:"Cafeter√≠a", subCat:"Caliente", name:"Americano", desc:"Caf√© caliente.", tags:["hot"], sizes:{ "12 oz":40, "16 oz":50 }, extrasRule:"coffee" },
      { id:"c_hot_cap", baseCat:"Cafeter√≠a", subCat:"Caliente", name:"Capuccino", desc:"Espuma y car√°cter.", tags:["hot"], sizes:{ "12 oz":40, "16 oz":50 }, extrasRule:"coffee" },
      { id:"c_hot_lat", baseCat:"Cafeter√≠a", subCat:"Caliente", name:"Latte", desc:"Cremoso y suave.", tags:["hot"], sizes:{ "12 oz":40, "16 oz":50 }, extrasRule:"coffee" },
      { id:"c_hot_fw",  baseCat:"Cafeter√≠a", subCat:"Caliente", name:"Flat White", desc:"Intenso, balanceado.", tags:["hot"], sizes:{ "12 oz":40, "16 oz":50 }, extrasRule:"coffee" },

      // Cafeter√≠a - Fr√≠os
      { id:"c_cold_ame", baseCat:"Cafeter√≠a", subCat:"Fr√≠o", name:"Americano (fr√≠o)", desc:"Caf√© fr√≠o.", tags:["cold"], sizes:{ "12 oz":50, "16 oz":60 }, extrasRule:"coffee" },
      { id:"c_cold_lat", baseCat:"Cafeter√≠a", subCat:"Fr√≠o", name:"Latte (fr√≠o)", desc:"Latte helado.", tags:["cold"], sizes:{ "12 oz":50, "16 oz":60 }, extrasRule:"coffee" },
      { id:"c_cold_cap", baseCat:"Cafeter√≠a", subCat:"Fr√≠o", name:"Capuccino (fr√≠o)", desc:"Versi√≥n fr√≠a.", tags:["cold"], sizes:{ "12 oz":50, "16 oz":60 }, extrasRule:"coffee" },

      // Cafeter√≠a - Frapp√©s
      { id:"c_fra_cafe", baseCat:"Cafeter√≠a", subCat:"Frapp√©", name:"Frappe Caf√©", desc:"Frapp√© base caf√©.", tags:["frappe"], sizes:{ "12 oz":55, "16 oz":65 }, extrasRule:"none" },
      { id:"c_fra_moc",  baseCat:"Cafeter√≠a", subCat:"Frapp√©", name:"Frappe Mocca", desc:"Chocolate + caf√©.", tags:["frappe"], sizes:{ "12 oz":55, "16 oz":65 }, extrasRule:"none" },
      { id:"c_fra_vai",  baseCat:"Cafeter√≠a", subCat:"Frapp√©", name:"Frappe Vainilla", desc:"Cl√°sico dulce.", tags:["frappe"], sizes:{ "12 oz":55, "16 oz":65 }, extrasRule:"none" },
      { id:"c_fra_car",  baseCat:"Cafeter√≠a", subCat:"Frapp√©", name:"Frappe Caramelo", desc:"Caramelo intenso.", tags:["frappe"], sizes:{ "12 oz":55, "16 oz":65 }, extrasRule:"none" },
      { id:"c_fra_cho",  baseCat:"Cafeter√≠a", subCat:"Frapp√©", name:"Frappe Chocolate", desc:"Chocolate fr√≠o.", tags:["frappe"], sizes:{ "12 oz":55, "16 oz":65 }, extrasRule:"none" },
      { id:"c_fra_chai", baseCat:"Cafeter√≠a", subCat:"Frapp√©", name:"Frappe Chai", desc:"Especiado y suave.", tags:["frappe"], sizes:{ "12 oz":55, "16 oz":65 }, extrasRule:"none" },

      // Especiales Cafeter√≠a
      { id:"c_sp_cho", baseCat:"Cafeter√≠a", subCat:"Caliente", name:"Chocolate caliente", desc:"Especial cafeter√≠a.", tags:["hot","special"], sizes:{ "12 oz":45, "16 oz":55 }, extrasRule:"none" },
      { id:"c_sp_chai", baseCat:"Cafeter√≠a", subCat:"Fr√≠o", name:"Chai (caliente o fr√≠o)", desc:"Especial cafeter√≠a.", tags:["cold","special"], sizes:{ "12 oz":50, "16 oz":60 }, extrasRule:"none", options:["Fr√≠o","Caliente"] },
      { id:"c_sp_lec", baseCat:"Cafeter√≠a", subCat:"Caliente", name:"Caf√© lechero", desc:"Especial cafeter√≠a.", tags:["hot","special"], sizes:{ "12 oz":45, "16 oz":55 }, extrasRule:"none" },
      { id:"c_sp_ton", baseCat:"Cafeter√≠a", subCat:"Fr√≠o", name:"Americano t√≥nico", desc:"Especial cafeter√≠a.", tags:["cold","special"], sizes:{ "12 oz":45, "16 oz":55 }, extrasRule:"none" },

      // Refresquer√≠a - Cl√°sicas
      { id:"r_cla_lim_nat", baseCat:"Refresquer√≠a", subCat:null, name:"Limonada natural", desc:"Bebida cl√°sica.", tags:["cold"], sizes:{ "20 oz":40, "32 oz":50 }, extrasRule:"general" },
      { id:"r_cla_lim_min", baseCat:"Refresquer√≠a", subCat:null, name:"Limonada mineral", desc:"Bebida cl√°sica.", tags:["cold"], sizes:{ "20 oz":40, "32 oz":50 }, extrasRule:"general" },
      { id:"r_cla_uvola", baseCat:"Refresquer√≠a", subCat:null, name:"Uvola", desc:"Bebida cl√°sica.", tags:["cold"], sizes:{ "20 oz":40, "32 oz":50 }, extrasRule:"general" },
      { id:"r_cla_root", baseCat:"Refresquer√≠a", subCat:null, name:"Root Beer", desc:"Bebida cl√°sica.", tags:["cold"], sizes:{ "20 oz":40, "32 oz":50 }, extrasRule:"general" },
      { id:"r_cla_sifon", baseCat:"Refresquer√≠a", subCat:null, name:"Sif√≥n", desc:"Bebida cl√°sica.", tags:["cold"], sizes:{ "20 oz":40, "32 oz":50 }, extrasRule:"general" },

      // Refresquer√≠a - Especiales
      { id:"r_sp_lim_sab", baseCat:"Refresquer√≠a", subCat:null, name:"Limonada (sabores)", desc:"Fresa / frutos rojos / mango / pepino.", tags:["cold","special"], sizes:{ "12 oz":50, "16 oz":60 }, extrasRule:"ten" },
      { id:"r_sp_limona", baseCat:"Refresquer√≠a", subCat:null, name:"Limonagr√≠a", desc:"Especial refresquer√≠a.", tags:["cold","special"], sizes:{ "12 oz":50, "16 oz":60 }, extrasRule:"ten" },
      { id:"r_sp_soda", baseCat:"Refresquer√≠a", subCat:null, name:"Soda italiana", desc:"Especial refresquer√≠a.", tags:["cold","special"], sizes:{ "12 oz":50, "16 oz":60 }, extrasRule:"ten" },

      // Snacks
      { id:"s_pepi", baseCat:"Snacks", subCat:null, name:"Pepihuates", desc:"Snack.", tags:[], sizes:{ "√önico":35 }, extrasRule:"none" },
      { id:"s_papas", baseCat:"Snacks", subCat:null, name:"Papas preparadas", desc:"Snack.", tags:[], sizes:{ "√önico":45 }, extrasRule:"none" },
      { id:"s_tosti", baseCat:"Snacks", subCat:null, name:"Tostilocos", desc:"Snack.", tags:[], sizes:{ "√önico":50 }, extrasRule:"none" },
      { id:"s_dori", baseCat:"Snacks", subCat:null, name:"Dorilocos", desc:"Snack.", tags:[], sizes:{ "√önico":50 }, extrasRule:"none" },
      { id:"s_pan", baseCat:"Snacks", subCat:null, name:"Pan / Galleta", desc:"Snack.", tags:[], sizes:{ "√önico":30 }, extrasRule:"none" },
    ];

    // ===== Estado =====
    let baseFilter = "all";
    let catFilter = "Todo";
    let subFilter = "all";
    let query = "";
    let cart = [];

    // ===== Helpers =====
    const $ = (sel)=>document.querySelector(sel);
    const money = (n)=>"$" + Number(n).toFixed(0);

    function setPortalTitle(){
      const el = $("#portalTitle");
      if(baseFilter==="Cafeter√≠a") el.textContent = "PORTAL ‚Äî CAFETER√çA";
      else if(baseFilter==="Refresquer√≠a") el.textContent = "PORTAL ‚Äî REFRESQUER√çA";
      else if(baseFilter==="Snacks") el.textContent = "PORTAL ‚Äî SNACKS";
      else el.textContent = "PORTAL ‚Äî MEN√ö";
    }

    function availableLeftCats(){
      if(baseFilter==="Cafeter√≠a") return ["Todo","Caliente","Fr√≠o","Frapp√©","Especiales"];
      if(baseFilter==="Refresquer√≠a") return ["Todo","Cl√°sicas","Especiales"];
      if(baseFilter==="Snacks") return ["Todo"];
      return ["Todo","Cafeter√≠a","Refresquer√≠a","Snacks"];
    }

    function matches(item){
      const baseOk = (baseFilter==="all") ? true : item.baseCat===baseFilter;

      let leftOk = true;
      if(catFilter!=="Todo"){
        if(baseFilter==="Cafeter√≠a"){
          if(catFilter==="Especiales") leftOk = item.baseCat==="Cafeter√≠a" && item.tags.includes("special");
          else leftOk = item.baseCat==="Cafeter√≠a" && item.subCat===catFilter;
        } else if(baseFilter==="Refresquer√≠a"){
          if(catFilter==="Especiales") leftOk = item.baseCat==="Refresquer√≠a" && item.tags.includes("special");
          else if(catFilter==="Cl√°sicas") leftOk = item.baseCat==="Refresquer√≠a" && !item.tags.includes("special");
          else leftOk = true;
        } else if(baseFilter==="Snacks"){
          leftOk = true;
        } else {
          leftOk = item.baseCat===catFilter;
        }
      }

      let subOk = true;
      if(baseFilter==="Cafeter√≠a"){
        subOk = (subFilter==="all") ? true : item.subCat===subFilter;
      }

      const q = query.trim().toLowerCase();
      const qOk = !q ? true : (
        item.name.toLowerCase().includes(q) ||
        (item.desc||"").toLowerCase().includes(q) ||
        (item.baseCat||"").toLowerCase().includes(q)
      );

      return baseOk && leftOk && subOk && qOk;
    }

    function renderBasePills(){
      document.querySelectorAll(".pill[data-base]").forEach(b=>{
        b.classList.toggle("active", b.dataset.base===baseFilter);
      });
      $("#baseAll").classList.toggle("active", baseFilter==="all");
    }

    function renderLeftCats(){
      const cats = availableLeftCats();
      const el = $("#cats");
      el.innerHTML = "";
      cats.forEach(c=>{
        const count = MENU.filter(m=>{
          const prev = catFilter;
          catFilter = c;
          const ok = matches(m);
          catFilter = prev;
          return ok;
        }).length;

        const btn = document.createElement("button");
        btn.className = "catbtn" + (c===catFilter ? " active":"");
        btn.innerHTML = `<span>${c}</span><span class="badge">${count}</span>`;
        btn.onclick = ()=>{
          catFilter = c;
          if(baseFilter==="all" && ["Cafeter√≠a","Refresquer√≠a","Snacks"].includes(c)){
            baseFilter = c;
            catFilter = "Todo";
          }
          renderAll();
        };
        el.appendChild(btn);
      });
    }

    function renderSubtabs(){
      const el = $("#subtabs");
      el.innerHTML = "";
      if(baseFilter!=="Cafeter√≠a") return;

      const tabs = ["all","Caliente","Fr√≠o","Frapp√©"];
      const labels = { all:"Todo", "Caliente":"‚òï Caliente", "Fr√≠o":"üßä Fr√≠o", "Frapp√©":"üåÄ Frapp√©" };

      tabs.forEach(t=>{
        const b = document.createElement("button");
        b.className = "pill" + (subFilter===t ? " active":"");
        b.textContent = labels[t];
        b.onclick = ()=>{ subFilter = t; renderAll(); };
        el.appendChild(b);
      });
    }

    function tagHTML(item){
      const chips = [];
      chips.push(`<span class="tag">${item.baseCat}</span>`);
      if(item.baseCat==="Cafeter√≠a" && item.subCat) chips.push(`<span class="tag">${item.subCat}</span>`);
      if(item.tags.includes("hot")) chips.push(`<span class="tag hot">Caliente</span>`);
      if(item.tags.includes("cold")) chips.push(`<span class="tag cold">Fr√≠o</span>`);
      if(item.tags.includes("frappe")) chips.push(`<span class="tag frappe">Frapp√©</span>`);
      if(item.tags.includes("special")) chips.push(`<span class="tag special">Especial</span>`);
      return chips.join("");
    }

    function renderCards(){
      const cards = $("#cards");
      const results = MENU.filter(matches);
      $("#resultHint").textContent = results.length ? `${results.length} opciones` : "Sin resultados";
      $("#sectionName").textContent = baseFilter==="all" ? "Todo" : baseFilter;

      cards.innerHTML = "";
      results.forEach(item=>{
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `
          <div class="tagrow">${tagHTML(item)}</div>
          <p class="name">${item.name}</p>
          <p class="desc">${item.desc || ""}</p>
          <div class="prices">
            ${Object.entries(item.sizes).map(([size, price])=>`
              <button class="pricebtn" data-id="${item.id}" data-size="${size}">
                <small>${size}</small> ${money(price)}
              </button>
            `).join("")}
          </div>
        `;
        div.querySelectorAll(".pricebtn").forEach(b=>{
          b.onclick = ()=> openModal(item.id, b.dataset.size);
        });
        cards.appendChild(div);
      });
    }

    // ===== Carrito =====
    function cartKey(row){
      return [row.id,row.size,row.option,row.extras,row.notes,row.price].join("|");
    }

    function addToCart(item, size, option, extras, notes){
      const basePrice = item.sizes[size] ?? 0;
      const extraPrice = Number((extras?.match(/\+(\d+)/)?.[1]) || 0);
      const price = basePrice + extraPrice;

      const row = {
        id:item.id,
        name:item.name,
        size,
        option: option || "Normal",
        extras: extras || "Sin extras",
        notes: notes || "",
        price,
        qty:1
      };
      row.key = cartKey(row);

      const existing = cart.find(x=>x.key===row.key);
      if(existing) existing.qty += 1;
      else cart.push(row);

      renderCart();
    }

    function renderCart(){
      const list = $("#cartlist");
      list.innerHTML = "";
      if(!cart.length){
        list.innerHTML = `<div class="hint" style="padding:10px; border:1px dashed rgba(26,37,80,.8); border-radius:14px; background:rgba(5,7,18,.25)">
          Tu carrito est√° vac√≠o. Toca un precio para agregar.
        </div>`;
        $("#total").textContent = money(0);
        updateFloating();
        return;
      }

      cart.forEach((c, idx)=>{
        const div = document.createElement("div");
        div.className = "lineitem";
        div.innerHTML = `
          <div style="min-width:0">
            <p class="li-title">${c.name}</p>
            <div class="li-sub">${c.size} ‚Ä¢ ${c.option}${c.extras && c.extras!=="Sin extras" ? " ‚Ä¢ " + c.extras : ""}${c.notes ? " ‚Ä¢ " + c.notes : ""}</div>
            <div class="li-sub" style="margin-top:6px; opacity:.9"><strong>${money(c.price)}</strong></div>
          </div>
          <div class="li-actions">
            <button class="mini" aria-label="Menos">‚àí</button>
            <div class="qty">${c.qty}</div>
            <button class="mini" aria-label="M√°s">+</button>
          </div>
        `;
        const [minus, plus] = div.querySelectorAll(".mini");
        minus.onclick = ()=>{
          c.qty -= 1;
          if(c.qty<=0) cart.splice(idx,1);
          renderCart();
        };
        plus.onclick = ()=>{ c.qty += 1; renderCart(); };
        list.appendChild(div);
      });

      const total = cart.reduce((s,x)=>s + x.price*x.qty, 0);
      $("#total").textContent = money(total);
      updateFloating();
    }

    // ===== Modal =====
    let modalItem = null;

    function extrasOptionsFor(item){
      if(item.extrasRule==="coffee" || item.extrasRule==="ten"){
        return ["Sin extras", "Extra (+10)"];
      }
      if(item.extrasRule==="general"){
        return ["Sin extras", "Chamoy (+5)", "Chamoy (+10)", "Miguelito (+5)", "Miguelito (+10)", "Salsa (+5)", "Salsa (+10)"];
      }
      return ["Sin extras"];
    }

    function openModal(itemId, preSize){
      modalItem = MENU.find(x=>x.id===itemId);
      if(!modalItem) return;

      $("#mTitle").textContent = modalItem.name;
      $("#mMeta").textContent = `${modalItem.baseCat}${modalItem.subCat ? " ‚Ä¢ " + modalItem.subCat : ""}`;

      const sizeSel = $("#mSize");
      sizeSel.innerHTML = Object.entries(modalItem.sizes)
        .map(([s,p])=>`<option value="${s}">${s} ‚Äî ${money(p)}</option>`).join("");
      if(preSize) sizeSel.value = preSize;

      const optSel = $("#mOption");
      const options = modalItem.options?.length ? modalItem.options : ["Normal"];
      optSel.innerHTML = options.map(o=>`<option value="${o}">${o}</option>`).join("");

      const extSel = $("#mExtras");
      const extOps = extrasOptionsFor(modalItem);
      extSel.innerHTML = extOps.map(e=>`<option value="${e}">${e}</option>`).join("");

      $("#mNotes").value = "";
      $("#modal").showModal();
    }

    $("#mClose").onclick = ()=>$("#modal").close();
    $("#mCancel").onclick = ()=>$("#modal").close();
    $("#mAdd").onclick = ()=>{
      const size = $("#mSize").value;
      const option = $("#mOption").value;
      const extras = $("#mExtras").value;
      const notes = $("#mNotes").value.trim();
      addToCart(modalItem, size, option, extras, notes);
      $("#modal").close();
    };

    // ===== WhatsApp =====
    function buildOrderText(){
      const lines = [];
      lines.push("Pedido ‚Äî CAF√â PORTAL");
      lines.push("‚Äî");
      cart.forEach(c=>{
        const extras = (c.extras && c.extras!=="Sin extras") ? ` ‚Ä¢ ${c.extras}` : "";
        const notes = c.notes ? ` ‚Ä¢ ${c.notes}` : "";
        lines.push(`${c.qty}√ó ${c.name} (${c.size}) ‚Ä¢ ${c.option}${extras}${notes} = ${money(c.price*c.qty)}`);
      });
      const total = cart.reduce((s,x)=>s + x.price*x.qty, 0);
      lines.push("‚Äî");
      lines.push("Total: " + money(total));
      lines.push("‚Äî");
      lines.push("Direcci√≥n: Gral. Pi√±a 197B, Col. Balderrama");
      return lines.join("\n");
    }

    function sendToWhatsApp(){
      if(!cart.length){
        alert("Tu carrito est√° vac√≠o üôÇ");
        return;
      }
      const text = buildOrderText();
      const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(text)}`;
      window.open(url, "_blank");
    }

    $("#checkout").onclick = sendToWhatsApp;

    // ===== Bot√≥n flotante =====
    function updateFloating(){
      const items = cart.reduce((s,x)=>s + x.qty, 0);
      const total = cart.reduce((s,x)=>s + x.price*x.qty, 0);
      $("#waBadge").textContent = `${items} item${items===1?"":"s"} ‚Ä¢ ${money(total)}`;
      $("#waFloat").style.opacity = cart.length ? "1" : "0.65";
    }
    $("#waFloat").onclick = sendToWhatsApp;

    // ===== Base pills =====
    function setBase(v){
      baseFilter = v;
      catFilter = "Todo";
      subFilter = "all";
      renderAll();
    }
    $("#baseAll").onclick = ()=>setBase("all");
    $("#baseCafe").onclick = ()=>setBase("Cafeter√≠a");
    $("#baseRef").onclick = ()=>setBase("Refresquer√≠a");
    $("#baseSnk").onclick = ()=>setBase("Snacks");

    // b√∫squeda
    $("#q").addEventListener("input", (e)=>{
      query = e.target.value;
      renderAll();
    });

    function renderAll(){
      setPortalTitle();
      renderBasePills();
      renderSubtabs();
      renderLeftCats();
      renderCards();
      renderCart();
    }

    // ===== Starfield (canvas) ligero =====
    (function initStarfield(){
      const canvas = document.getElementById("starfield");
      const ctx = canvas.getContext("2d", { alpha:true });

      let w=0, h=0, dpr=1;
      let stars = [];
      let lastT = 0;

      function resize(){
        dpr = Math.min(window.devicePixelRatio || 1, 2);
        w = Math.floor(window.innerWidth);
        h = Math.floor(window.innerHeight);
        canvas.width = Math.floor(w * dpr);
        canvas.height = Math.floor(h * dpr);
        canvas.style.width = w + "px";
        canvas.style.height = h + "px";
        ctx.setTransform(dpr,0,0,dpr,0,0);

        const count = Math.floor((w*h)/22000); // densidad
        stars = Array.from({length: count}, ()=>({
          x: Math.random()*w,
          y: Math.random()*h,
          r: Math.random()*1.6 + 0.2,
          a: Math.random()*0.55 + 0.15,
          s: Math.random()*0.18 + 0.04, // velocidad
          tw: Math.random()*0.9 + 0.3,  // twinkle
          p: Math.random()*Math.PI*2
        }));
      }

      function draw(t){
        const dt = Math.min((t - lastT) / 1000, 0.05);
        lastT = t;

        ctx.clearRect(0,0,w,h);

        // ligera neblina
        ctx.fillStyle = "rgba(57,184,255,0.02)";
        ctx.fillRect(0,0,w,h);

        for(const st of stars){
          st.y += st.s * (28 * dt);
          if(st.y > h+2){ st.y = -2; st.x = Math.random()*w; }

          st.p += dt * st.tw;
          const alpha = st.a * (0.7 + 0.3*Math.sin(st.p));

          ctx.beginPath();
          ctx.fillStyle = `rgba(234,240,255,${alpha.toFixed(3)})`;
          ctx.arc(st.x, st.y, st.r, 0, Math.PI*2);
          ctx.fill();
        }

        requestAnimationFrame(draw);
      }

      window.addEventListener("resize", resize, {passive:true});
      resize();
      requestAnimationFrame((t)=>{ lastT=t; draw(t); });
    })();

    // init
    updateFloating();
    renderAll();
  </script>
</body>
</html>